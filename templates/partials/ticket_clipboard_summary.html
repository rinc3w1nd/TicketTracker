<article class="ticket-clipboard-summary">
  {% from "partials/_clipboard_summary_macros.html" import with_section, format_timestamp %}

  {% call with_section('header', sections) %}
    <header>
      <h1>{{ ticket.title }}</h1>
    </header>
  {% endcall %}

  {% call with_section('timestamps', sections) %}
    <section>
      <h2>Timeline</h2>
      <p>
        <strong>Created:</strong>
        {{ format_timestamp(ticket.created_at) }}<br />
        <strong>Updated:</strong>
        {{ format_timestamp(ticket.updated_at) }}
      </p>
    </section>
  {% endcall %}

  {% call with_section('meta', sections) %}
    <section>
      <h2>Details</h2>
      <ul>
        <li><strong>Status:</strong> {{ ticket.status }}</li>
        <li><strong>Priority:</strong> {{ ticket.priority }}</li>
        <li><strong>Due:</strong> {{ ticket.due_badge_label }}</li>
        {% if ticket.sla_countdown %}
          <li><strong>SLA:</strong> {{ ticket.sla_countdown }}</li>
        {% endif %}
      </ul>
    </section>
  {% endcall %}

  {% call with_section('people', sections) %}
    {% if ticket.requester or ticket.watchers %}
      <section>
        <h2>People</h2>
        <ul>
          {% if ticket.requester %}
            <li><strong>Requester:</strong> {{ ticket.requester }}</li>
          {% endif %}
          {% if ticket.watchers %}
            <li><strong>Watchers:</strong> {{ ticket.watchers|join(', ') }}</li>
          {% endif %}
        </ul>
      </section>
    {% endif %}
  {% endcall %}

  {% call with_section('description', sections) %}
    {% if ticket.description %}
      <section>
        <h2>Description</h2>
        <p>{{ ticket.description|urlize|replace('\n', '<br />')|safe }}</p>
      </section>
    {% endif %}
  {% endcall %}

  {% call with_section('links', sections) %}
    {% if ticket.links %}
      <section>
        <h2>Links</h2>
        <p>{{ ticket.links|urlize|replace('\n', '<br />')|safe }}</p>
      </section>
    {% endif %}
  {% endcall %}

  {% call with_section('notes', sections) %}
    {% if ticket.notes %}
      <section>
        <h2>Notes</h2>
        <p>{{ ticket.notes|urlize|replace('\n', '<br />')|safe }}</p>
      </section>
    {% endif %}
  {% endcall %}

  {% call with_section('tags', sections) %}
    {% if ticket.tags %}
      <section>
        <h2>Tags</h2>
        <ul>
          {% for tag in ticket.tags %}
            <li>{{ tag.name }}</li>
          {% endfor %}
        </ul>
      </section>
    {% endif %}
  {% endcall %}

  {% call with_section('updates', sections) %}
    {% if updates %}
      <section>
        <h2>Recent Updates</h2>
        <ol>
          {% for update in updates %}
            <li>
              <p>
                <strong>{{ format_timestamp(update.created_at) }}</strong>
                by
                {{ 'System' if update.is_system else (update.author or config.default_submitted_by) }}
              </p>
              {% if update.status_from or update.status_to %}
                <p>
                  <strong>Status:</strong>
                  {{ update.status_from or '—' }} → {{ update.status_to or '—' }}
                </p>
              {% endif %}
              <p>{{ update.body|urlize|replace('\n', '<br />')|safe }}</p>
            </li>
          {% endfor %}
        </ol>
      </section>
    {% endif %}
  {% endcall %}
</article>
